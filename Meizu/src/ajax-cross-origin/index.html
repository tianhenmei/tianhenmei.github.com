<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>ajax跨域请求</title>
    </head>
    <body>
        <script type="text/javascript" src="../common/js/jquery.1.10.1.min.js"></script>
        <script>
            // $.ajax({
            //     url:'http://0.0.0.0:9000/test/ajaxCross',
            //     type:'get',
            //     // data:{
            //     //     credentials:true
            //     // },
            //     success:function(data){
            //         console.log(data)
            //     },
            //     error:function(error){
            //         console.log(error)
            //     }
            // })
            /*
            $.ajax({
                type:"GET",
                url:"http://rtb.flyme.cn/dsp/track?action=CLICK&p=RDFFNDhBMDQ3MjhGQUE3NjI4MDRGRUU3MzA2NTJDMzg4RDBEMEY1MjI4NjEyRTEwMDI1NEE3MjE4ODZGNTA3QjcwMDM0MEYzOTRFQTZBNkNERjYwMDQ3NDA0NUUzODMzREY2RUI3QTYxNjc0MTQ0RTI5QjVFNTNGOUU0NTE0QzhBNzk0RUU5NjBDM0FGRjlFMDJDQ0NEMzc5NzdFRUUyRkQ2OTRBMzAwMzNEOEQ0MDFGMEVERDY5QUUyOEIwNzcxQkE3OUU2MkUxMDNERjdCRUZERjc4NUMxNkVERjU0MzIyOUU1QTk2OTNCRjUwOEMwRUI3Nzc0N0NEOENGNkNFMjA4NTlBMjZGMjRGM0QzMDc2QzhCN0I1NjMxODE3RjUzNUIxMEY3RjRGNTlDREU4MjlDNzVFOUY1QUY1OUM4MTA2NTE2QjRCNUUzNUM1RUEyNjQyQUUyQkE5OTZBMjcwQ0QwRjE0NDE0OENENENENkJFMzIxOTc0ODYzNTA1M0M1RDI4MjQzODA1RTZCRThFMDU4MTEzMzBDN0I5NDQ0QjE3ODQ2NjYyNkU3MEYwMjlEQUYyNThERUJEOEU3Q0MwRDM5MDY3QjM1OTdCMjAzRTVBRkZDRDJBMzMwNjQxOEEwRTlCNjFCM0EyMTE1NDlBRjI5NDc0Q0ZCQUFENzkwNTE5MENENjg2QjJFRDQ0NzRBNUZENzA1NTQwMzlGNTBEQkI2MDI5RTNBODA5NDI4Q0RDMjc3ODU5RkIyQ0IwQjgxRkRFQ0MwREY2Mzg2QkVBNkFBNUY4QUVDNEVBRjJCM0Q3ODNFQzVENDE5NkJFNEFFNEQ5MTRCMzg2MjExQjg1RjJFRkQ4MjUxM0U1RDYyM0FDNjdGQTg4NjczRTYwOTBD&price=&lp=",
                dataType: "jsonp",
                success:function(data1,data2){
                    console.log(data1)
                },
                error: function(xhr, exception){
                    console.log(xhr.status)
                    if( xhr.status === 0)
                        alert('Error : ' + xhr.status + 'You are not connected.');
                    else if( xhr.status == "201")
                        alert('Error : ' + xhr.status + '\nServer error.');
                    else if( xhr.status == "404")
                        alert('Error : ' + xhr.status + '\nPage note found');
                    else if( xhr.status == "500")
                        alert('Internal Server Error [500].');
                    else if (exception === 'parsererror') 
                        alert('Error : ' + xhr.status + '\nImpossible to parse result.');
                    else if (exception === 'timeout')
                        alert('Error : ' + xhr.status + '\nRequest timeout.');
                    else
                        alert('Error .\n' + xhr.responseText);
                }
            });
            */
            function getCompanyData() {
                $.ajax({
                    async: false,
                    url:"http://meta.lagou.com/code/create-jsonp",
                    jsonp:'callback',
                    dataType:'jsonp',
                    success: function(data) {
                        console.log(data)
                    },
                    error: function(error) {
                        console.log(error.message);
                    }
                });
            }
            
            function getJsonpData(src){
                var script = document.createElement('script'),
                    now = Date.now()
                script.id = now
                script.setAttribute("type","text/javascript");
                script.onload = script.onreadstatechange = function(data){
                    console.log(this)
                    console.log(data)
                }
                script.src = src
                document.body.appendChild(script)
            }
            function setJSONPData(data){
                console.log(data)
            }
            // getJsonpData('http://0.0.0.0:9000/test/ajaxJsonp?callback=setJSONPData')
            getJsonpData('http://rtb.flyme.cn/dsp/track?action=CLICK&p=RDFFNDhBMDQ3MjhGQUE3NjI4MDRGRUU3MzA2NTJDMzg4RDBEMEY1MjI4NjEyRTEwMDI1NEE3MjE4ODZGNTA3QjcwMDM0MEYzOTRFQTZBNkNERjYwMDQ3NDA0NUUzODMzREY2RUI3QTYxNjc0MTQ0RTI5QjVFNTNGOUU0NTE0QzhBNzk0RUU5NjBDM0FGRjlFMDJDQ0NEMzc5NzdFRUUyRkQ2OTRBMzAwMzNEOEQ0MDFGMEVERDY5QUUyOEIwNzcxQkE3OUU2MkUxMDNERjdCRUZERjc4NUMxNkVERjU0MzIyOUU1QTk2OTNCRjUwOEMwRUI3Nzc0N0NEOENGNkNFMjA4NTlBMjZGMjRGM0QzMDc2QzhCN0I1NjMxODE3RjUzNUIxMEY3RjRGNTlDREU4MjlDNzVFOUY1QUY1OUM4MTA2NTE2QjRCNUUzNUM1RUEyNjQyQUUyQkE5OTZBMjcwQ0QwRjE0NDE0OENENENENkJFMzIxOTc0ODYzNTA1M0M1RDI4MjQzODA1RTZCRThFMDU4MTEzMzBDN0I5NDQ0QjE3ODQ2NjYyNkU3MEYwMjlEQUYyNThERUJEOEU3Q0MwRDM5MDY3QjM1OTdCMjAzRTVBRkZDRDJBMzMwNjQxOEEwRTlCNjFCM0EyMTE1NDlBRjI5NDc0Q0ZCQUFENzkwNTE5MENENjg2QjJFRDQ0NzRBNUZENzA1NTQwMzlGNTBEQkI2MDI5RTNBODA5NDI4Q0RDMjc3ODU5RkIyQ0IwQjgxRkRFQ0MwREY2Mzg2QkVBNkFBNUY4QUVDNEVBRjJCM0Q3ODNFQzVENDE5NkJFNEFFNEQ5MTRCMzg2MjExQjg1RjJFRkQ4MjUxM0U1RDYyM0FDNjdGQTg4NjczRTYwOTBD&price=&lp=&callback=setJSONPData')

            var xhr = null
            if(window.XMLHttpRequest){
                xhr = new XMLHttpRequest()
            }else{
                xhr = new ActiveXObject('Microsoft.XMLHTTP')
            }
            xhr.onreadystatechange = function(){
                if(xhr.readyState == 4){
                    // console.log('over')
                    console.log(JSON.parse(xhr.responseText))
                }
            }
            // xhr.open('GET','http://rtb.flyme.cn/dsp/track?action=CLICK&p=RDFFNDhBMDQ3MjhGQUE3NjI4MDRGRUU3MzA2NTJDMzg4RDBEMEY1MjI4NjEyRTEwMDI1NEE3MjE4ODZGNTA3QjcwMDM0MEYzOTRFQTZBNkNERjYwMDQ3NDA0NUUzODMzREY2RUI3QTYxNjc0MTQ0RTI5QjVFNTNGOUU0NTE0QzhBNzk0RUU5NjBDM0FGRjlFMDJDQ0NEMzc5NzdFRUUyRkQ2OTRBMzAwMzNEOEQ0MDFGMEVERDY5QUUyOEIwNzcxQkE3OUU2MkUxMDNERjdCRUZERjc4NUMxNkVERjU0MzIyOUU1QTk2OTNCRjUwOEMwRUI3Nzc0N0NEOENGNkNFMjA4NTlBMjZGMjRGM0QzMDc2QzhCN0I1NjMxODE3RjUzNUIxMEY3RjRGNTlDREU4MjlDNzVFOUY1QUY1OUM4MTA2NTE2QjRCNUUzNUM1RUEyNjQyQUUyQkE5OTZBMjcwQ0QwRjE0NDE0OENENENENkJFMzIxOTc0ODYzNTA1M0M1RDI4MjQzODA1RTZCRThFMDU4MTEzMzBDN0I5NDQ0QjE3ODQ2NjYyNkU3MEYwMjlEQUYyNThERUJEOEU3Q0MwRDM5MDY3QjM1OTdCMjAzRTVBRkZDRDJBMzMwNjQxOEEwRTlCNjFCM0EyMTE1NDlBRjI5NDc0Q0ZCQUFENzkwNTE5MENENjg2QjJFRDQ0NzRBNUZENzA1NTQwMzlGNTBEQkI2MDI5RTNBODA5NDI4Q0RDMjc3ODU5RkIyQ0IwQjgxRkRFQ0MwREY2Mzg2QkVBNkFBNUY4QUVDNEVBRjJCM0Q3ODNFQzVENDE5NkJFNEFFNEQ5MTRCMzg2MjExQjg1RjJFRkQ4MjUxM0U1RDYyM0FDNjdGQTg4NjczRTYwOTBD&price=&lp=',true)
            // xhr.send()
            // xhr.open('GET','http://0.0.0.0:9000/test/ajaxCross',true)
            // xhr.send()











            // console.log('send end')
            /* xhr.open(method,url,isasync)
             * method: 指定发送请求的方式,不区分大小写,但通常使用大写字母
             * url: 相对于执行代码的当前页面，且只能向同一个域中使用相同端口和协议的URL发送请求
             * isasync: 表示是否异步发送请求的布尔值，如果不填写，默认为true，表示异步发送
             * 如果请求一个受密码保护的URL，把用于认证的用户名和密码作为第4和第5个参数传递给open()方法
            */
            /* xhr.send(data)
             * data: 即要作为请求主体发送的数据。调用send()方法后，请求被分派到服务器
             * 如果是GET方法，send()方法无参数，或参数为null；如果是POST方法，send()方法的参数为要发送的数据
            */

            
            /* 一个完整的HTTP响应由状态码、响应头集合和响应主体组成。
             * responseText: 作为响应主体被返回的文本(文本形式)
             * responseXML: 如果响应的内容类型是'text/xml'或'application/xml'，这个属性中将保存着响应数据的XML DOM文档(document形式)
             * status: HTTP状态码(数字形式)
             * statusText: HTTP状态说明(文本形式)
             * 
             * 在接收到响应后，第一步是检查status属性，以确定响应已经成功返回。
             * 一般来说，可以将HTTP状态码为200作为成功的标志。
             * 此时，responseText属性的内容已经就绪，而且在内容类型正确的情况下，responseXML也可以访问了。
             * 此外，状态码为304表示请求的资源并没有被修改，可以直接使用浏览器中缓存的版本；当然，也意味着响应是有效的
             * 无论内容类型是什么，响应主体的内容都会保存到responseText属性中，而对于非XML数据而言，responseXML属性的值将为null
             * if((xhr.status >=200 && xhr.status < 300) || xhr.status == 304){
             *     alert(xhr.responseText);
             * }else{
             *     alert('request was unsuccessful:' + xhr.status);
             * }
             * 
             * 如果接受的是同步响应，则需要将open()方法的第三个参数设置为false，那么send()方法将阻塞直到请求完成。
             * 一旦send()返回，仅需要检查XHR对象的status和responseText属性即可
             * 同步请求是吸引人的，但应该避免使用它们。
             * 客户端javascript是单线程的，当send()方法阻塞时，它通常会导致整个浏览器UI冻结。
             * 如果连接的服务器响应慢，那么用户的浏览器将冻结
             * //发送请求
             * xhr.open('get','/uploads/rs/26/ddzmgynp/message.xml',false);
             * xhr.send();
             * //同步接受响应
             * if(xhr.readyState == 4){
             *     if(xhr.status == 200){
             *         //实际操作
             *         result.innerHTML += xhr.responseText;
             *     }
             * }
             * 
             * 如果需要接收的是异步响应，这就需要检测XHR对象的readyState属性，该属性表示请求/响应过程的当前活动阶段。这个属性可取的值如下：
             * 0(UNSENT):未初始化。尚未调用open()方法
             * 1(OPENED):启动。已经调用open()方法，但尚未调用send()方法
             * 2(HEADERS_RECEIVED):发送。己经调用send()方法，且接收到头信息
             * 3(LOADING):接收。已经接收到部分响应主体信息
             * 4(DONE):完成。已经接收到全部响应数据，而且已经可以在客户端使用了
             * 
             * 理论上，只要readyState属性值由一个值变成另一个值，都会触发一次readystatechange事件。
             * 可以利用这个事件来检测每次状态变化后readyState的值。通常，我们对readyState值为4的阶段感兴趣，因为这时所有数据都已就绪
             * [注意]必须在调用open()之前指定onreadystatechange 事件处理程序才能确保跨浏览器兼容性，否则将无法接收readyState属性为0和1的情况
             * //异步接受响应
             * xhr.onreadystatechange = function(){
             *     if(xhr.readyState === 4){
             *         if(xhr.status == 200){
             *              //实际操作
             *              result.innerHTML += xhr.responseText;
             *         }
             *     }
             * }
             * //发送请求
             * xhr.open('get','message.xml',true);
             * xhr.send();
             * 
             * XHR对象的timeout属性等于一个整数，表示多少毫秒后，如果请求仍然没有得到结果，就会自动终止。该属性默认等于0，表示没有时间限
             * 如果请求超时，将触发ontimeout事件
             * [注意]IE8-浏览器不支持该属性
             * xhr.open('post','test.php',true);
             * xhr.ontimeout = function(){
             *     console.log('The request timed out.');
             * }
             * xhr.timeout = 1000;
             * xhr.send();
            */
        </script>
    </body>
</html>